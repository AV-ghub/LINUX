> Эви Немет, Iр Снайер, 'ент ХеАн, Бен Уэйли, Дэн Маки
> Unix и Linu: руоводство системного адинистратра
> 5-е издание
## СТАНДАРТНОЕ УПРАВЛЕНИЕ ДОСТУПОМ в UNIX
### Контроль доступа к файловой системе
В стандартной модели кажый файл имеет как ваельца, так и группу, иногда называемую " групповым влаельцем " . Владелец может устанавивать разрешения дя файла.  
Влаелец файла определяет, что могут сделать с н им члены групп. Эта схема позволяет делиться файлами межу членами одного и того же проекта.  
Влаельца файла можно определить с помощью команды ls -1:
```
$ ls -1 ~qarth/ todo
- rw- r - - - - - 1 g a r t h s t a f f 1 2 5 9 Мау 2 9 1 9 : 5 5 / U s e r s / g a r t h / todo
```
Данный файл принадежит пользователю garth и группе staff.   
В подавляющем большинстве случаев идентификационные ***номера пользователей*** (короткие идентификаторы UID) сопоставяются с именами пользователей в файле **/etc/passwd**, а идентификационные ***номера групп*** ( GID) сопотавляются с именами групп в файле **/etc/group**.  

### Учетная запись суперпользователя root
Определяющей характеристи кой учетной записи root я вляется е е иде нтифи катор UID , равный О.  
Процесс , котор ый запрашивает ваш парол ь при входе в систему, изначаьно запускается с правами пользователя root. Если введенный вами пароль и имя пользователя явяются законными, то программа входа в с истему login изменяет свои UID и GID на ваш и UID и GID и запускает среду оболочки или графический пол ьзовател ьский и нтерфейс.  

Когда ядро запускает испол н я е м ы й файл с установлен н ы м и бита м и разреш е н и я s e t u i d или s e t g i d , о н о изменяет текущий идентификатор U I D или G I D результирующего процесса на U I D или G I D файла, содержащего образ программ ы , а не на U I D и G I D пользователя , который ввел команду. Таким образом, привиегии пол ьзователя распространяются только на выполнение этой конкретной команды.  

Учетные записи root не содержат инфрмации о том , какие операции выпол нялись с правами root.  
Сценарий входа в систему не содержит записей о том , кто на самом деле выполняет данную работ Если у несколькх польвателей есть дост к учетной зписи root, вы не сможете определить, кт ее испольова и когда.  

Лучше получать доступ к учетной записи root с помощью команды **su**. При вызове без аргументов она выдает приглашение на ввод пароля пользователя root, а затем запускает оболочку с привилегированными правами. Эти права будут сохраняться , пока вы не завершите работу (нажав комбинацию кавиш **<Ctrl+D>** или выполнив команду **exit**). 

Команда su не фиксирует действия, производимые привилегированным пользователем, но добавляет запись в журнальный файл с указанием , кто и когда вошел в систему под именем root.  
Команда su способна также подставлять вместо имени root имена других пол ьзователей. 

Зная чей-либо пароль, можно непосредственно зарегистрироваться в системе под его именем, введя команду  ***su - имя_пользователя***.
При использовани и в качестве кюча команды su дефиса **(-)** оболочка перейдет в **режим регистрации**.  
Точная реализация этого режима зависит от конкретной оболочки , но обычно в этом режиме меняются количество и имена файлов запуска, считываемых интерпретатором.
Например, в режиме регистрации оболочка bash считывет файл ***~/ . bashyrofile***, а вне эог режима - файл ***~/ . bashrc***. При диагнотике пролем конкретног поьвателя режм регистрации позволяет максимаьно точно вспризвести среду в которой он работал.

В некоторых системах, чтобы использовать команду su, необходимо быть членом гуппы wheel.  

### Программа sudo: ограниченный вариант команды su
Эта программа доступна в форме исходного кода на сайте sudo.ws.  
Программа sudo прверяет файл **/etc/sudoers**.  
> В течение пяти мину поле запука программа sudo позволяет выполнять команды без обязательного введения пароля

Регистрацию команд в программе sudo можно легко обойти с помощью таких трюков, как временный выход в оболочку из разрешенной программ ы , или команды **sudo sh** и **sudo su**. (Такие команды отображаются в журнаах, поэтому вы по крайней мере узнаете, что они бьuш запущены.)  

Программа sudo настраивается на выполнение команды с правами root без необходимости вводить пароль. Для справки, эта конфигурация задается с помощью к ючевого слова NOPAS SWD в файе sudoers. Например:
```
ansible ALL = ( ALL ) NOPASSWD : ALL
```

Правило закл ючается в том , что sudo все гда подчиняется последней соответствующей строке , причем совпаде ние определяется все ми четырьмя параметрам и : и менем пользователя , хостом, и менем целевого пол ьзователя и командой.   

В системе Linux, команда **passwd -l** блокирует учетную запись, добавляя знак ! к зашифрованному паролю.   
Система Ubuntu поставляется с откл юченной уетной записью root, и весь административный доступ осуществляется через программу sudo или ее эквивалент с графическим пользовательским интерейсом. Еслихотите, можете ***установить пароль root на Ubuntu***, а затем ***разблокировать учетную запись*** с помощью команды 
```
sudo passwd -u root
```

### Системные учетные записи, отличные от root
Вы можете идентифицировать эти фиктивные учетн ые записи по их идентификаторам UID, которые обычно не превышают 100. Чаще всего идентификаторы UID менее 10 относятся к системным учетным записям , а UID от 10 до 100 - к псевопользователям , связнным с определенными ком понентам и программ ного обеспечения.  

### Пространства имен Linux
Система Linux может распределять процессы по иерархическим разделам (простанствам имен), ***из которых видна только часть системных файлов, сетевых портов и процессов***. Ломимо прочего, эта схема действует как форма превентивного контроля доступа. Вместо того, чтобы основывать решения управения дотупом на потенциаьно тонких критериях, ядро просто отицает существовние объектов, которые не видны изнутри данной области.   
Внутри раздела процессы мог выполняться с правами root, не опасаясь, что они могут поставить под угрозу другие части системы.   
Этот умный трюк является одним из оснований для ***программной контейнеризации*** и его наиболее известной реаизации **Docker**.   

## СОВРЕМЕННЫЙ КОНТРОЛЬ ДОСТУПА 
Агентство национаьной безопасности США предожило и нтегрировать свою систему Enhanced Linux (SELinux) в ядро в качестве стандартного средства.   
По нескольким причинам сторонники ядра сопротивялись этому слиянию. Вместо того чтобы использовать SELinux ии другую альтернативную систему, они разработаи и нтерфейс уровня ядра API **Linux Security Modules**, позволяющий системам управения доступом и нтегрироватья в качестве загружаемых модулей ядра.   
Системы на основе LSM не действуют, если пользователи не загрузили и не включили их. Этот факт снижает барьеры дя включен ия в стандартное ядро, и система Linux теперь поставляется с **SELinux** и четырьмя другим и системами (**AppAnor, Smack, ТОМОУО и Yama**) , готовыми к работе.   
К сожалению, система LSM требует явного сотрудничества межу активными модулями, и ни оди н из существующих модулей не вкючает эту функцию. 
> На данный момент системы Linux фактически ограничены выбором одного дополн ительного модуля LSM.

### Обязательный контроль доступа
С исте м ы мандатного упра в е н ия доступом (**mandatory access control - МАС**) позволяют адм и н истратора м п и сать пол итики контроля доступа, которые переопределяют ии допол н я ют избирательные разреш е н и я традиционной модели . Например, вы можете установить правило, что домаш ние катаоrи пользователей доступны только их ваельцам . Тога не важно, что пользователь делает приватную коп и ю конфиден циаьного документа и небрежно относится к разрешениям документа; в л юбом случае никто ничего не может увидеть в домашн е м каталоге этого польователя.   
Общим дя реа изаци й МАС явл яется то, что они обыч но доба вяют в с исте му контроля доступа централизован ные, написан ные адм ин истраторм ( ил и поставяемые поставщиком ) пол итики, а также обыч ное сочетание разрешений файлов, списков управления доступом и атрибутов процесса.   
### Контроль доступа на основе ролей
Еще одна функция, которая обычно проверяется системами контроля дотупа, - это контроль доступа на основе ролей (также известный как **RBAC**).   
Основная идея состоит в том , чтобы добавить слой косвенности в управение доступом к вычислениям. Разрешения назначаются не пользователям непоредственно, а промежуточным конструкциям, называемым ролями , а рол и , в свою очередь, назначаются пользователям.   
Роли похожи на разные rруппы U N IX, но они носят более общий характер, поскольку моrут использоватья вне контекста файловой системы. Роли также моrут образвывать иерархии, что значительно упрощает администрирование.    
### SELinux: улучшенная безопасность Linux
S E Linux является одной из старейших реаизаций системы Linux **МАС**.  
Система SELiпux испольует максимаистский подход и реализует почти ве возможноти МАС и RBAC, которые можно себе представить.   
Несмотря на сложность управения , внедрение систе м ы SELinux меден но расшираяется, особенно в таких средах, как правител ьтвенные орга н ы , финансы и здравоохранение, которые имеют высокие и конкретные требования к безопасности. Она также ***явяется стандартной частью платформы Adroid***.   
Фай ***/etc/selinux/config*** - это элемент управления верхнего уровня дя систем SELinux. В нем есть и нтересные строки:
```
SELINUX=enforcing
SELINUXTYPE= targeted
```
Первая строка и меет три возможн ых знач е н ия : e n f o r c i n g , p e r m i s s i v e ил и d i s a Ы e d . П араметр e n f o r c i n g гарантирует, что загруже н ная пол итика применяется и запре щает наруш е н ия. Параметр ре rmi s s i ve допус кает наруше н и я , но регистр и ­ рует их в журнале s ys l og , что полезно дя отладки и разработки п ол итики. П араметр d i s aЫed полностью откючает систему SELinux. Имя SELINUXTYPE представляет собой имя используемой базы дан н ых пол итик. Это, по суrи, имя подкатаог1 внуrри катаога /etc/ selinux. В оди н и тот же момент врем е н и применяться может тол ько одна пол итика, а доступные наборы пол итик зависят от с исте м ы .   


































